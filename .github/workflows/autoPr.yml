name: create automatic PR

on:
  push:
    branches:
      - main

jobs:
  generate_pr:
    name: generate pr for main branch
    runs-on: self-hosted

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: extract git commit data
      uses: auto-deploy-poc/git-commit-data-action@v1.0.0

    - name: update author information
      run: echo ${{  env.GIT_COMMIT_AUTHOR_NAME  }} > AUTHOR

    - name: Raise PR
      uses: peter-evans/create-pull-request@v3
      with:
        branch: "auto-pr-branch"
        base: "main"
        title: "Automatic PR"
        committer: ${{  env.GIT_COMMIT_AUTHOR_NAME  }} <${{ env.GIT_COMMIT_AUTHOR_EMAIL }}">
        author: ${{  env.GIT_COMMIT_AUTHOR_NAME  }} <${{ env.GIT_COMMIT_AUTHOR_EMAIL }}">
        body:
          This is an automatic PR generated by the GitHub Action.
        token: ${{ secrets.COMMIT_TOKEN }}
        delete-branch: true